<?php
	function getVulnerabilities($conn, $keyword = "", $filters = array(), $page = 0)
	{
		$filters_condition = "1";
;
		foreach ($filters as $filter) {

			$filters_condition = $filters_condition . ",'" . $filter."'";


		}


		if ($page < 0) {
			$page = 0;
		}

		if (trim($keyword) != "") {
			$stmt = $conn->prepare("SELECT *FROM news WHERE ( titlu LIKE ? OR autor LIKE ? ) AND category NOT IN (" . $filters_condition . ")  ORDER by new DESC, date DESC LIMIT " . intval(($page * 30)) . ",30");
			$stmt->execute(array("%" . $keyword . "%", "%" . $keyword . "%"));
			$stmt2 = $conn->prepare("SELECT *FROM news  WHERE (titlu LIKE :keyword OR autor LIKE :keyword2)  AND category NOT IN (" . $filters_condition . ")");
			$stmt2->execute(array("keyword" => "%" . $keyword . "%", "keyword2" => "%" . $keyword . "%"));
			$nr_results = count($stmt2->fetchAll());
		} else {
			$stmt = $conn->prepare("SELECT *FROM news WHERE category NOT IN (" . $filters_condition . ") ORDER by new DESC, date DESC LIMIT " . ($page * 30) . ",30");
			$stmt->execute();
			$nr_results = count($conn->query("SELECT *FROM news WHERE category NOT IN (" . $filters_condition . ")")->fetchAll());
		}

		return array("nr_results" => $nr_results, "results" => $stmt);
	}

?>