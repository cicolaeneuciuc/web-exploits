var url=window.location.toString();
var page=0;
var keyword="";
var filters=new Array();
function getVulnerabilities( p=page,  keywords=keyword, filters=filters){
    $.get("load-vulnerabilities.php?p="+p+"&keyword="+keywords+"&filters="+filters,function(data){
        $("#content-vulnerabilities").html("");
        var json=JSON.parse(data);
        console.log(json.results.length);
        for(var i=0;i<json.results.length;i++){
            var new_logo="";
            if(json.results[i].new=="1"){
                new_logo="<img src='assets/img/new.gif' style='width: 30px; height: auto;'>";
            }
            $("#content-vulnerabilities").append("<tr>\n" +
                "                            <td>\n" +
                "                                 \n" + new_logo+
                "\n" +
                "                                \n" +
                "                            </td>\n" +
                "\t\t\t\t\t\t\t<td>\n" +
                "\t\t\t\t\t\t\t\t"+json.results[i].date+"\n" +
                "\t\t\t\t\t\t\t</td>\n" +
                "\t\t\t\t\t\t\t<td>\n" +
                "\t\t\t\t\t\t\t\t<a href=\""+json.results[i].link+"\"> "+json.results[i].titlu+"</a>\n" +
                "\t\t\t\t\t\t\t</td>\n" +
                "\t\t\t\t\t\t\t<td>\n" +
                "\t\t\t\t\t\t\t\t<a href=view-raw.php?id=\""+json.results[i].id+"\">View Content</a>\n" +
                "\t\t\t\t\t\t\t</td>\n" +
                "\t\t\t\t\t\t\t<td>\n" +
                "\t\t\t\t\t\t\t\t"+json.results[i].autor+"\n" +
                "\t\t\t\t\t\t\t</td>\n" +
                "\t\t\t\t\t\t\t<td>"+json.results[i].category+"</td>\n" +
                "\t\t\t\t\t\t</tr>")
        }
        if(json.results.length==0){
            $("#content-vulnerabilities").html("<h3 style='color: white; text-align: center;'>No entries found!</h3>");
        }
        $("#pages").html("");
        for(var i=1;i<json.nr_results/30;i++){
            if(i==page){
                $("#pages").append("<a onclick='changePage("+i+")' href='#' style=\"color: white\" >"+(i)+" </a>&nbsp; &nbsp;");
            }else{
                $("#pages").append("<a onclick='changePage("+i+")'  href='#' >"+(i)+" </a>&nbsp; &nbsp;");
            }
        }
    });
}

function removeParam(key, url) {
    if (!url) url = window.location.href;

    var hashParts = url.split('#');

    var regex = new RegExp("([?&])" + key + "=.*?(&|#|$)", "i");

    if (hashParts[0].match(regex)) {
        //REMOVE KEY AND VALUE
        url = hashParts[0].replace(regex, '$1');

        //REMOVE TRAILING ? OR &
        url = url.replace(/([?&])$/, '');

        //ADD HASH
        if (typeof hashParts[1] !== 'undefined' && hashParts[1] !== null)
            url += '#' + hashParts[1];
    }

    return url;
}



function filter() {
    filters=new Array();
    for (var i = 1; i <= 4; i++) {
        var check = document.getElementById("c" + i);

        if (check.checked !== true) {
            filters.push(check.getAttribute("value"));
        }
    }


    getVulnerabilities(page,keyword,JSON.stringify(filters));

}

function changePage(p){
    page=p;
    getVulnerabilities(page,keyword,JSON.stringify(filters));
}

function search(keyword_searched){
    keyword=keyword_searched;
    getVulnerabilities(page,keyword,JSON.stringify(filters));
}





