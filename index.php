<?php
session_start ();
?>
<!DOCTYPE HTML>
<html class="" lang="en-US">
<head>
	<meta charset="UTF-8">

	<title>Vulnerabilities App Alert</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/css.css">

	<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
</head>
<body>
<div class="static_nav">
	<img src="assets/img/3.png" class="icon_mobile" onclick="open_menu()">
	<p class="text_l"><span style="">Security</span> API</p>
	<a href="index.php"><p class="home_but">Home</p></a>
	<a href="#" id="modal-history-btn"><p class="home_but">History</p></a>
	<a href="#" id="modal-how-to-use-btn"><p class="home_but">How to use</p></a>
	<a href="#" id="modal-aboneaza-te-btn"><p class="home_but">Subscribe</p></a>
	<a href="api.json.php"><img src="assets/img/1.png" class="icon_right"></a>
	<a href="api.rss.php"><img src="assets/img/2.png" class="icon_right"></a>
	<form action="index.php" method="GET"
	      style="display: inline-block; float: right; margin-right: 50px; margin-top:5px">
		<input placeholder="Keyword..." required type="text" name="keyword"
		       value="<?php if ( isset($_GET[ "keyword" ]) ) {
				   echo $_GET[ "keyword" ];
			   } ?>" class="input">
		<input type="submit" value="Search" class="buton">
	</form>
</div>
<div class="left" id="left">
	<br>

	<p class="text_l" style="    text-align: center;
    width: 100%; margin-left: 0px">Categorii</p>
	<hr>

	<label class="switch ">
		<input type="checkbox" class="check" id="c1" onclick="thisFunc1()" checked>
		<span class="slider round"></span>
	</label>
	<p class="buton_open">WebApps</p><br>

	<label class="switch round">
		<input type="checkbox" class="check" id="c2" onclick="thisFunc2()" checked>
		<span class="slider round"></span>
	</label>
	<p class="buton_open">Remote</p><br>
	<label class="switch round">
		<input type="checkbox" class="check" id="c3" onclick="thisFunc3()" checked>
		<span class="slider round"></span>
	</label>

	<p class="buton_open">Local</p><br>
	<label class="switch round">
		<input type="checkbox" class="check" id="c4" onclick="thisFunc4()" checked>
		<span class="slider round"></span>
	</label>
	<p class="buton_open">DOS</p><br>
    <hr>
    <a href="api.json.php"><img src="assets/img/1.png" class="icon_right2"></a>
    <a href="api.rss.php"><img src="assets/img/2.png" class="icon_right2"></a><br>
    <a href="index.php"><p class="home_but2">Home</p></a>
    <a href="#" id="modal-history-btn"><p class="home_but2">History</p></a>
    <a href="#" id="modal-how-to-use-btn"><p class="home_but2">How to use</p></a>
    <a href="#" id="modal-aboneaza-te-btn"><p class="home_but2">Subscribe</p></a>
    <form action="index.php" method="GET" style="display:block;margin-top:5px">
        <input placeholder="Keyword..." required type="text" name="keyword"
               value="<?php if ( isset($_GET[ "keyword" ]) ) {
                   echo $_GET[ "keyword" ];
               } ?>" class="input2">
        <input type="submit" value="Search" class="buton2">
    </form>

</div>
<div class="right">
	<?php
	include ('db.php');
	include ("functions.php");
	if ( !isset($_GET[ "p" ]) ) {
		$_GET[ "p" ] = 0;
	} else {
		$_GET[ "p" ] = $_GET[ "p" ] - 1;
	}
	
	if ( isset($_GET[ "keyword" ]) ) {
		$stmt = $conn -> prepare ("SELECT *FROM news WHERE titlu LIKE ? OR autor LIKE ? ORDER by date_row DESC LIMIT " . intval (($_GET[ "p" ] * 30)) . ",30");
		$stmt -> execute (array ("%" . $_GET[ "keyword" ] . "%", "%" . $_GET[ "keyword" ] . "%"));
		$stmt2 = $conn -> prepare ("SELECT *FROM news  WHERE titlu LIKE :keyword");
		$stmt2 -> execute (array ("keyword" => "%" . $_GET[ "keyword" ] . "%"));
		$nr_results = count ($stmt2 -> fetchAll ());
	} else {
		$stmt = $conn -> prepare ("SELECT *FROM news ORDER by date_row DESC LIMIT " . ($_GET[ "p" ] * 30) . ",30");
		$stmt -> execute ();
		$nr_results = count ($conn -> query ("SELECT *FROM news") -> fetchAll ());
	}
	
	if (isset($_SESSION[ "eroare" ])){
	?>

	<div class="show_this">
		<div class="alert">
			<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
			<center><strong>Alert!</strong> <?php if ( isset($_SESSION[ "eroare" ]) ) {
					echo $_SESSION[ "eroare" ];
					unset($_SESSION[ "eroare" ]);
				} ?></center>
		</div>
		<?php
		}
		
		
		if (isset($_SESSION[ "mesaj" ])){
		?>

		<div class="show_this">
			<div class="success">
				<span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
				<center><strong>Success!</strong> <?php if ( isset($_SESSION[ "mesaj" ]) ) {
						echo $_SESSION[ "mesaj" ];
						unset($_SESSION[ "mesaj" ]);
					} ?></center>
			</div>
			<?php
			}
			?>
			<center><h1><?php echo "Vulnerabilities"; ?></h1></center>
			
			<center>
				<?php
				for ( $i = 0; $i <= $nr_results / 30; $i++ ) {
					if ( isset($_GET[ "keyword" ]) ) {
						?>
						<a <?php if ( $i == $_GET[ "p" ] ) { ?> style="color: white" <?php } ?>
								href="index.php?p=<?php echo $i + 1; ?>&keyword=<?php echo $_GET[ "keyword" ]; ?>"><?php echo $i + 1; ?>
						</a>&nbsp; &nbsp;
						<?php
					} else {
						?>
						<a href="index.php?p=<?php echo $i + 1; ?>" <?php if ( $i == $_GET[ "p" ] ) { ?> style="color: white" <?php } ?>><?php echo $i + 1; ?> </a>&nbsp; &nbsp;
						<?php
					}
					
				}
				?>
			</center>
			<br>
			<table align="center">
				<thead>
				<tr>

					<th>Date</th>
					<th>Title</th>
					<th>Raw</th>
					<th>Autor</th>
					<th>Category</th>
				</tr>
				</thead>
				<tbody>
				<?php $i = 0;
				foreach ( $stmt as $row ) { ?>
					<tr class="row-category-<?php echo $row[ "category" ]; ?>">

						<td>
							<?php echo $row[ "date" ]; ?>
						</td>
						<td>
							<a href="<?php echo $row[ "link" ]; ?>"> <?php echo $row[ "titlu" ]; ?></a>
						</td>
						<td>
							<a href="<?php echo $row[ "raw" ]; ?>">View Content</a>
						</td>
						<td>
							<?php echo $row[ "autor" ]; ?>
						</td>
						<td><?php echo $row[ "category" ]; ?></td>
					</tr>
				<?php } ?>
				</tbody>
			</table>
		</div>
		<center>
			<?php
			for ( $i = 0; $i <= $nr_results / 30; $i++ ) {
				if ( isset($_GET[ "keyword" ]) ) {
					?>
					<a <?php if ( $i == $_GET[ "p" ] ) { ?> style="color: white" <?php } ?>
							href="index.php?p=<?php echo $i + 1; ?>&keyword=<?php echo $_GET[ "keyword" ]; ?>"><?php echo $i + 1; ?>
					</a>&nbsp; &nbsp;
					<?php
				} else {
					?>
					<a href="index.php?p=<?php echo $i + 1; ?>" <?php if ( $i == $_GET[ "p" ] ) { ?> style="color: white" <?php } ?>><?php echo $i + 1; ?> </a>&nbsp; &nbsp;
					<?php
				}
				
			}
			?>
		</center>
		<br>
	</div>

	<p style="font-size: 20px; color: white; text-align: center">Copyright &copy; <?php echo date ("Y"); ?> Leuciuc
		Nicolae</p>
	<br><br>
	<br><br>


	<!-- The Modal -->
	<div id="modal-history" class="modal">

		<!-- Modal content -->
		<div class="modal-content">
			<span class="close">&times;</span>
			<h2 style="color: #d54f33">History</h2>
			<hr>
			<?php include ("history.php"); ?>
		</div>

	</div>


	<!-- The Modal -->
	<div id="modal-how-to-use" class="modal">

		<!-- Modal content -->
		<div class="modal-content">
			<span class="close">&times;</span>
			<h2 style="color: #d54f33">How to use</h2>
			<hr>
			<?php include ("how-to-use.php"); ?>
		</div>

	</div>


	<div id="modal-aboneaza-te" class="modal">

		<!-- Modal content -->
		<div class="modal-content">
			<span class="close">&times;</span>
			<h2 style="color: #d54f33">Subscribe</h2>
			<hr>
			<form action="subscribe.php" method="POST" style="display:block">
				<input placeholder="Your Email..." required type="email" name="email" class="input input_full">
				<br>
				
				<label class="switch ">
					<input type="checkbox" name="category[]" value="webapps"  checked>
					<span class="slider round"></span>
				</label>
				<p class="buton_open">WebApps</p><br>
				
				<label class="switch round">
					<input type="checkbox" name="category[]" value="remote" checked>
					<span class="slider round"></span>
				</label>
				<p class="buton_open">Remote</p><br>
				
				<label class="switch round">
					<input type="checkbox" name="category[]" value="local" checked>
					<span class="slider round"></span>
				</label>
				<p class="buton_open">Local</p><br>
				
				<label class="switch round">
					<input type="checkbox" name="category[]" value="dos" checked>
					<span class="slider round"></span>
				</label>
				<p class="buton_open">DOS</p><br>
				
				<input type="submit" value="Subscribe" value="dos" class="buton center_but">
			</form>
		</div>

	</div>
	<script src="assets/js/script.js"></script>
	<script src="assets/js/modal.js"></script>
</body>
</html>
