<?php
	session_start();
	include('db.php');
	include("functions.php");
	include("Vulnerabilities.php");
	if (!isset($_GET["p"])) {
		$page = 0;
	} else {
		$page = $_GET["p"] - 1;
	}

	if (!isset($_GET["keyword"])) {
		$keyword = "";
	} else {
		$keyword = $_GET["keyword"];
	}

	if (!isset($_GET["filters"])) {
		$filters = array();
	} else {
		if (count($_GET["filters"]) == 0 || !isJson($_GET["filters"])) {
			$filters = array();
		}else{
			$filters=json_decode($_GET["filters"],true);
		}
	}
	$result = getVulnerabilities($conn, $keyword, $filters, $page);
	$array=array();
	$stmt=$result["results"];
	$nr_results = $result["nr_results"];
	foreach ($stmt as $row) {
		array_push($array,$row);
	}
	$result["results"]=$array;
	echo json_encode($result);
?>